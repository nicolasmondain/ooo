---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('posts', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 6);

const base = import.meta.env.BASE_URL;

function formatDate(date) {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  }).format(date);
}
---

<BaseLayout>
  <div class="mx-auto max-w-2xl">
    {
      posts.length > 0 ? (
        <div class="mt-10 space-y-16">
          {posts.map(({ slug, data }) => (
            <article class="flex max-w-xl flex-col items-start justify-between">
              <div class="flex items-center gap-x-4 text-xs">
                <time
                  datetime={data.pubDate.toISOString()}
                  class="text-gray-500 dark:text-gray-400"
                >
                  {formatDate(data.pubDate)}
                </time>
                {data.tags.length > 0 && (
                  <a
                    href={`${base}tags/${encodeURIComponent(data.tags[0])}/`}
                    class="relative z-10 rounded-full bg-gray-50 px-3 py-1.5 font-medium text-gray-600 hover:bg-gray-100 dark:bg-gray-800/60 dark:text-gray-300 dark:hover:bg-gray-800"
                  >
                    {data.tags[0]}
                  </a>
                )}
              </div>

              <div class="group relative">
                <h3 class="mt-3 text-lg/6 font-semibold text-gray-900 group-hover:text-gray-600 dark:text-white dark:group-hover:text-gray-300">
                  <a href={`${base}posts/${slug}/`}>
                    <span class="absolute inset-0" />
                    {data.title}
                  </a>
                </h3>
                <p class="mt-5 line-clamp-3 text-sm/6 text-gray-600 dark:text-gray-400">
                  {data.description}
                </p>
              </div>

              <div class="relative mt-8 flex items-center gap-x-4">
                <img
                  src={`${base}favicon.svg`}
                  alt="ooo logo"
                  class="size-10 rounded-full bg-gray-50 dark:bg-gray-800"
                />
                <div class="text-sm/6">
                  <p class="font-semibold text-gray-900 dark:text-white">
                    <span>ooo</span>
                  </p>
                  <p class="text-gray-600 dark:text-gray-300">Author</p>
                </div>
              </div>
            </article>
          ))}
        </div>
      ) : (
        <div class="mt-10">
          <p class="text-center text-gray-500 dark:text-gray-400">
            No posts yet. Create your first post in{' '}
            <code>src/content/posts/</code>.
          </p>
        </div>
      )
    }

    {
      posts.length > 0 && (
        <div class="mt-16 text-center">
          <a
            href={`${base}posts`}
            class="inline-flex items-center rounded-md bg-gray-900 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-gray-800 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-900 dark:bg-gray-800 dark:shadow-none dark:hover:bg-gray-700 dark:focus-visible:outline-gray-800"
          >
            View all posts â†’
          </a>
        </div>
      )
    }
  </div>
</BaseLayout>
