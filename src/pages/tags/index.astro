---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts', ({ data }) => !data.draft);
const tagMap = new Map<string, number>();
for (const p of posts) {
  for (const t of p.data.tags) {
    tagMap.set(t, (tagMap.get(t) ?? 0) + 1);
  }
}
const tags = Array.from(tagMap.entries()).sort((a, b) => a[0].localeCompare(b[0]));
const base = import.meta.env.BASE_URL;
---

<BaseLayout title="Tags â€¢ ooo" description="Browse posts by tag">
  <h1 class="text-2xl font-bold tracking-tight mb-6">Tags</h1>
  <ul class="flex flex-wrap gap-3">
    {tags.map(([tag, count]) => (
      <li>
        <a class="rounded bg-slate-100 dark:bg-slate-800 px-3 py-1 text-sm hover:underline" href={`${base}tags/${encodeURIComponent(tag)}/`}>
          #{tag} <span class="text-slate-500">({count})</span>
        </a>
      </li>
    ))}
  </ul>
</BaseLayout>
